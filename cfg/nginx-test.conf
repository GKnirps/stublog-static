user guido;
daemon off;
worker_processes 1;
error_log stderr info;
pid ./nginx.pid;

http {
    access_log /dev/stdout;
    server {
        listen localhost:8080;

        add_header X-Clacks-Overhead "GNU Terry Pratchett";
        add_header Content-Security-Policy "default-src 'none'; style-src 'self'; img-src 'self'; frame-ancestors 'none';";
        add_header Referrer-Policy "no-referrer";

        root ./dist;
        location / {}

        gzip_static on;

        ## home page
        rewrite ^/$ /home.html;
        ## tag index page
        rewrite ^/tags/?$ /tags/index.html;
        ## category index page
        rewrite ^/categories/?$ /categories/index.html;

        ## error pages
        error_page 404 /404.html;

        ## redirect from /blogposts/ to /archive (for backwards compatibility)
        rewrite ^/blogposts/?$ /archive/1 permanent;

        ## allow requesting pages without .html
        rewrite ^([^\.]+)$ $1.html;
        types {
            text/html html;
            image/jpeg jpg jpeg;
            text/css css;
            image/png png;
        }
        location /feed.atom {
            default_type application/feed+atom;
        }
    }
}
events {}
